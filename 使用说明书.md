# 使用说明书

## 简介
本工具是基于 **PySide6 (GUI)** 和 **Playwright** 开发的「知识星球」文件批量下载器。
它提供了一个直观的图形界面，支持持久化登录、星球订阅列表获取、文件列表滚动加载、批量下载、下载历史记忆以及一键打开文件位置等功能。

## 核心特性
- **图形化界面**：操作简单，无需命令行。
- **持久化登录**：只需登录一次，后续自动保持登录状态。
- **精准下载**：采用 JS 精准定位与弹窗标题双重校验，杜绝“下错文件”或“点击错位”。
- **批量下载**：支持多选文件，一键批量加入下载队列。
- **历史记忆**：自动检测本地已下载文件，避免重复下载。
- **自动清理**：下载完成后自动清理临时缓存文件，保持磁盘整洁。

## 环境要求
- 操作系统：Windows
- Python：3.x
- 依赖库：
  ```bash
  pip install pyside6 playwright
  python -m playwright install chromium
  ```

## 目录说明
- **启动脚本**：`src/main.py`
- **下载目录**：`./downloads`（自动创建）
- **登录数据**：`./browser_data/zsxq`（保存登录 Cookie 等信息）
- **核心源码**：`src/core/zsxq_api.py`
- **界面源码**：`src/gui/main_window.py`

## 快速开始

1. **启动程序**
   在终端运行：
   ```bash
   python src/main.py
   ```

2. **登录检测**
   - 程序启动后会自动检测登录状态。
   - 若状态显示“未登录”，请点击 **“手动检测登录”**。
   - 在弹出的浏览器窗口中扫码登录知识星球。
   - 登录成功后，程序会自动刷新状态为“已登录”并加载订阅列表。

3. **选择星球**
   - 在左侧列表中点击你想下载的星球名称。
   - 程序会自动控制浏览器跳转到该星球，并尝试进入“星球文件”页面。

4. **加载文件**
   - 点击右侧的 **“加载更多文件”** 按钮。
   - 程序会自动控制浏览器滚动页面，抓取文件列表。
   - 抓取到的文件会显示在表格中。

5. **下载文件**
   - **单文件下载**：点击对应文件行的 **“下载”** 按钮。
   - **批量下载**：
     - 勾选需要下载的文件（或点击 **“全选”**）。
     - 点击 **“批量下载选中”** 按钮。
   - **状态查看**：
     - 本地已存在的文件会自动显示为 **“已下载”**，按钮变为 **“打开位置”**。
     - 下载成功后，状态会更新为 **“下载成功”**，点击 **“打开位置”** 可直接在资源管理器中选中文件。

## 常见问题

**Q: 点击下载后没有反应？**
A: 请查看界面下方的“日志”区域。如果显示“Modal title mismatch”，说明弹窗内容与预期不符，程序为了安全拦截了下载。请尝试重新加载文件列表。

**Q: 浏览器闪退或无法启动？**
A: 请确保没有其他 Playwright 进程或残留的 Chrome 窗口在运行。尝试重启程序。

**Q: 下载的文件在哪里？**
A: 默认保存在项目根目录下的 `downloads` 文件夹中。点击界面上的“打开位置”按钮可直接定位。

**Q: 如何重新登录？**
A: 删除 `browser_data` 目录即可清除登录状态，重启程序后需重新扫码。
